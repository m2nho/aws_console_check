{% extends "base.html" %}

{% block title %}{{ service_title }} - AWS 콘솔 체크{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('consolidated_view') }}">통합 대시보드</a></li>
        <li class="breadcrumb-item active">{{ service_title }}</li>
    </ol>
</nav>

<h1 class="mb-4">{{ service_title }} 정보</h1>

{% if service_name == 'ec2' %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">EC2 인스턴스</h5>
        </div>
        <div class="card-body">
            {% if data.instances %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>인스턴스 ID</th>
                                <th>인스턴스 유형</th>
                                <th>상태</th>
                                <th>가용 영역</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for instance in data.instances %}
                            <tr>
                                <td>{{ instance.id }}</td>
                                <td>{{ instance.type }}</td>
                                <td>
                                    {% if instance.state == 'running' %}
                                        <span class="badge bg-success">실행 중</span>
                                    {% elif instance.state == 'stopped' %}
                                        <span class="badge bg-danger">중지됨</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ instance.state }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ instance.az }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">EC2 인스턴스가 없습니다.</div>
            {% endif %}
        </div>
    </div>

{% elif service_name == 's3' %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">S3 버킷</h5>
        </div>
        <div class="card-body">
            {% if data.buckets %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>버킷 이름</th>
                                <th>생성일</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for bucket in data.buckets %}
                            <tr>
                                <td>{{ bucket.name }}</td>
                                <td>{{ bucket.creation_date }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">S3 버킷이 없습니다.</div>
            {% endif %}
        </div>
    </div>

{% elif service_name == 'rds' %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">RDS 데이터베이스</h5>
        </div>
        <div class="card-body">
            {% if data.instances %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>인스턴스 ID</th>
                                <th>엔진</th>
                                <th>상태</th>
                                <th>인스턴스 클래스</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for instance in data.instances %}
                            <tr>
                                <td>{{ instance.id }}</td>
                                <td>{{ instance.engine }}</td>
                                <td>
                                    {% if instance.status == 'available' %}
                                        <span class="badge bg-success">사용 가능</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ instance.status }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ instance.size }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">RDS 인스턴스가 없습니다.</div>
            {% endif %}
        </div>
    </div>

{% elif service_name == 'lambda' %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Lambda 함수</h5>
        </div>
        <div class="card-body">
            {% if data.functions %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>함수 이름</th>
                                <th>런타임</th>
                                <th>메모리 (MB)</th>
                                <th>타임아웃 (초)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for function in data.functions %}
                            <tr>
                                <td>{{ function.name }}</td>
                                <td>{{ function.runtime }}</td>
                                <td>{{ function.memory }}</td>
                                <td>{{ function.timeout }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">Lambda 함수가 없습니다.</div>
            {% endif %}
        </div>
    </div>

{% elif service_name == 'cloudwatch' %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">CloudWatch 경보</h5>
        </div>
        <div class="card-body">
            {% if data.alarms %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>경보 이름</th>
                                <th>상태</th>
                                <th>지표</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for alarm in data.alarms %}
                            <tr>
                                <td>{{ alarm.name }}</td>
                                <td>
                                    {% if alarm.state == 'OK' %}
                                        <span class="badge bg-success">정상</span>
                                    {% elif alarm.state == 'ALARM' %}
                                        <span class="badge bg-danger">경보</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ alarm.state }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ alarm.metric }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">CloudWatch 경보가 없습니다.</div>
            {% endif %}
        </div>
    </div>

{% elif service_name == 'iam' %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">IAM 사용자</h5>
        </div>
        <div class="card-body">
            {% if data.users %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>사용자 이름</th>
                                <th>생성일</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in data.users %}
                            <tr>
                                <td>{{ user.name }}</td>
                                <td>{{ user.created }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">IAM 사용자가 없습니다.</div>
            {% endif %}
        </div>
    </div>
{% endif %}

<!-- 체크리스트 섹션이 삭제되었습니다 -->

<!-- 추천 사항 섹션 -->
{% if recommendations %}
    <div class="recommendations-container">
        {% for rec in recommendations %}
            <div class="recommendation-card" data-recommendation-id="{{ loop.index }}">
                <div class="card-header">
                    <h5>{{ service_title }} 추천 사항</h5>
                    <span class="severity-badge severity-{{ 'high' if rec.severity == '높음' else 'medium' if rec.severity == '중간' else 'low' }}">
                        {{ rec.severity }}
                    </span>
                </div>
                <div class="card-body">
                    <!-- 요약 정보 (항상 표시) -->
                    <div class="resource-info">
                        <h6>리소스 정보</h6>
                        <p><strong>리소스:</strong> {{ rec.resource }}</p>
                        {% if service_name == 'ec2' and rec.resource == 'i-0758f1823d43bfada' %}
                            <p><strong>인스턴스 유형:</strong> t3.medium</p>
                            <p><strong>상태:</strong> 실행 중</p>
                        {% endif %}
                    </div>
                    
                    <!-- 요약 메시지 (항상 표시) -->
                    <div class="summary-message mb-3">
                        <p class="lead mb-2">{{ rec.message }}</p>
                        <button class="btn btn-sm btn-outline-primary toggle-details" data-bs-toggle="collapse" data-target="details-{{ loop.index }}">
                            <i class="fas fa-chevron-down me-1"></i> 상세 정보 보기
                        </button>
                    </div>
                    
                    <!-- 상세 정보 (토글 가능) - 새로운 드롭다운 스타일 -->
                    <div class="collapse mt-3" id="details-{{ loop.index }}">
                        <div class="card card-body bg-light border-0 p-3">
                        <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-2"><i class="fas fa-exclamation-triangle me-2"></i>문제점</h6>
                                <p class="mb-0">{% if service_name == 'ec2' and rec.resource == 'i-0758f1823d43bfada' %}EC2 인스턴스 i-0758f1823d43bfada가 t3.medium 타입으로 실행 중입니다. 이 타입이 워크로드에 최적화되지 않을 수 있습니다.{% else %}{{ rec.problem }}{% endif %}</p>
                            </div>
                            
                            <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-2"><i class="fas fa-chart-line me-2"></i>영향</h6>
                                <p class="mb-0">{% if service_name == 'ec2' and rec.resource == 'i-0758f1823d43bfada' %}인스턴스 타입이 워크로드에 최적화되지 않으면 성능 저하나 불필요한 비용이 발생할 수 있습니다.{% else %}{{ rec.impact }}{% endif %}</p>
                            </div>
                            
                            <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-2"><i class="fas fa-tasks me-2"></i>권장 조치</h6>
                                {% if service_name == 'ec2' and rec.resource == 'i-0758f1823d43bfada' %}
                                <ol class="ps-3 mb-0">
                                    <li class="mb-1">CloudWatch 지표를 확인하여 현재 인스턴스의 CPU, 메모리, 네트워크 사용량을 분석합니다.</li>
                                    <li class="mb-1">AWS Compute Optimizer 권장 사항을 확인합니다.</li>
                                    <li class="mb-1">워크로드에 적합한 인스턴스 타입으로 변경을 계획합니다.</li>
                                    <li class="mb-1">인스턴스를 중지하고 인스턴스 타입을 변경한 후 다시 시작합니다.</li>
                                </ol>
                                {% else %}
                                <ol class="ps-3 mb-0">
                                    {% for step in rec.steps %}
                                        <li class="mb-1">{{ step }}</li>
                                    {% endfor %}
                                </ol>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <h6 class="fw-bold text-muted mb-2"><i class="fas fa-check-circle me-2"></i>기대 효과</h6>
                                <p class="mb-0">{% if service_name == 'ec2' and rec.resource == 'i-0758f1823d43bfada' %}적절한 인스턴스 타입을 선택하면 성능을 향상시키고 비용을 최적화할 수 있습니다.{% else %}{{ rec.benefit }}{% endif %}</p>
                            </div>
                            
                            <div>
                                <h6 class="fw-bold text-muted mb-2"><i class="fas fa-book me-2"></i>참고 자료</h6>
                                {% if service_name == 'ec2' and rec.resource == 'i-0758f1823d43bfada' %}
                                <ul class="ps-3 mb-0">
                                    <li><a href="#" target="_blank">EC2 인스턴스 크기 조정 가이드</a></li>
                                    <li><a href="#" target="_blank">AWS Compute Optimizer</a></li>
                                </ul>
                                {% else %}
                                <ul class="ps-3 mb-0">
                                    {% for link in rec.links %}
                                        <li><a href="{{ link.url }}" target="_blank">{{ link.title }}</a></li>
                                    {% endfor %}
                                </ul>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn btn-later">나중에</button>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}

<div class="mt-4">
    <a href="{{ url_for('consolidated_view') }}" class="btn btn-outline-dark">통합 대시보드로 돌아가기</a>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/recommendation-card-updated.css') }}">
<style>
    .modal {
        z-index: 1050 !important;
    }
    .modal-backdrop {
        z-index: 1040 !important;
    }
    .modal-dialog {
        z-index: 1050 !important;
    }
    .collapse .modal-dialog {
        margin: 0.5rem 0;
        max-width: 100%;
    }
    .collapse .modal-content {
        border: 1px solid rgba(0,0,0,.125);
        border-radius: 0.25rem;
    }
    .table td {
        position: relative;
    }
    .collapse {
        position: relative;
        z-index: 1000;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/checklist-toggle.js') }}"></script>
<script src="{{ url_for('static', filename='js/recommendation-card.js') }}"></script>
{% endblock %}


























