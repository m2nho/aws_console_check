{% extends "base.html" %}

{% block title %}통합 대시보드 - AWS 콘솔 체크{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item active">통합 대시보드</li>
    </ol>
</nav>

<h1 class="mb-4">AWS 서비스 통합 대시보드</h1>
<p class="lead">모든 AWS 서비스의 정보를 한 페이지에서 확인하세요.</p>

<div class="mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <button class="btn btn-primary" id="expand-all">모두 펼치기</button>
            <button class="btn btn-outline-secondary ms-2" id="collapse-all">모두 접기</button>
        </div>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="auto-refresh" checked>
            <label class="form-check-label" for="auto-refresh">자동 새로고침 (30초)</label>
        </div>
    </div>
</div>


{% include 'sections/ec2_section.html' %}
{% include 'sections/s3_section.html' %}
{% include 'sections/rds_section.html' %}
{% include 'sections/lambda_section.html' %}
{% include 'sections/cloudwatch_section.html' %}
{% include 'sections/iam_section.html' %}
{% include 'sections/dynamodb_section.html' %}
{% include 'sections/ecs_section.html' %}
{% include 'sections/eks_section.html' %}
{% include 'sections/elasticache_section.html' %}
{% include 'sections/route53_section.html' %}
{% include 'sections/sns_section.html' %}
{% include 'sections/sqs_section.html' %}



{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Make tables sortable
        const tables = document.querySelectorAll('.table-sortable');
        if (tables) {
            tables.forEach(table => {
                const headers = table.querySelectorAll('th');
                headers.forEach((header, index) => {
                    header.addEventListener('click', function() {
                        sortTable(table, index);
                    });
                    header.title = '클릭하여 정렬';
                });
            });
        }
        
        // Function to sort tables
        function sortTable(table, column) {
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const direction = table.getAttribute('data-sort-direction') === 'asc' ? -1 : 1;
            
            // Sort the rows
            rows.sort((a, b) => {
                const aValue = a.querySelectorAll('td')[column].textContent.trim();
                const bValue = b.querySelectorAll('td')[column].textContent.trim();
                
                if (!isNaN(aValue) && !isNaN(bValue)) {
                    return direction * (Number(aValue) - Number(bValue));
                } else {
                    return direction * aValue.localeCompare(bValue, 'ko');
                }
            });
            
            // Update the table
            rows.forEach(row => tbody.appendChild(row));
            
            // Toggle the sort direction
            table.setAttribute('data-sort-direction', direction === 1 ? 'asc' : 'desc');
        }
        
        // Handle expand/collapse all buttons
        const expandAllBtn = document.getElementById('expand-all');
        const collapseAllBtn = document.getElementById('collapse-all');
        
        if (expandAllBtn) {
            expandAllBtn.addEventListener('click', function() {
                document.querySelectorAll('.service-section .collapse').forEach(section => {
                    const bsCollapse = new bootstrap.Collapse(section, { toggle: false });
                    bsCollapse.show();
                });
            });
        }
        
        if (collapseAllBtn) {
            collapseAllBtn.addEventListener('click', function() {
                document.querySelectorAll('.service-section .collapse').forEach(section => {
                    const bsCollapse = new bootstrap.Collapse(section, { toggle: false });
                    bsCollapse.hide();
                });
            });
        }
        
        // Handle refresh button
        const refreshBtn = document.getElementById('refresh-data');
        const lastRefreshSpan = document.getElementById('last-refresh');
        
        if (refreshBtn) {
            refreshBtn.addEventListener('click', function() {
                // Add spinning animation to the refresh icon
                const refreshIcon = refreshBtn.querySelector('i');
                refreshIcon.classList.add('refreshing');
                
                // Disable the button during refresh
                refreshBtn.disabled = true;
                
                // Reload the page
                setTimeout(() => {
                    window.location.reload();
                }, 500);
            });
        }
        
        // Auto refresh functionality
        const autoRefreshToggle = document.getElementById('auto-refresh');
        let refreshInterval;
        
        if (autoRefreshToggle) {
            // Initialize auto refresh based on the toggle state
            if (autoRefreshToggle.checked) {
                startAutoRefresh();
            }
            
            // Toggle auto refresh on change
            autoRefreshToggle.addEventListener('change', function() {
                if (this.checked) {
                    startAutoRefresh();
                } else {
                    stopAutoRefresh();
                }
            });
        }
        
        function startAutoRefresh() {
            // Clear any existing interval
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            // Set new interval (30 seconds)
            refreshInterval = setInterval(() => {
                // Update the last refresh time
                updateLastRefreshTime();
                
                // Add spinning animation to the refresh icon
                const refreshIcon = refreshBtn.querySelector('i');
                refreshIcon.classList.add('refreshing');
                
                // Reload the page
                window.location.reload();
            }, 30000);
        }
        
        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
        }
        
        // Update the last refresh time
        function updateLastRefreshTime() {
            if (lastRefreshSpan) {
                lastRefreshSpan.textContent = '마지막 업데이트: 방금 전';
            }
        }
        
        // Update the last refresh time every minute
        setInterval(() => {
            if (lastRefreshSpan && lastRefreshSpan.textContent === '마지막 업데이트: 방금 전') {
                lastRefreshSpan.textContent = '마지막 업데이트: 1분 전';
            } else if (lastRefreshSpan) {
                const currentText = lastRefreshSpan.textContent;
                const minutes = parseInt(currentText.match(/\d+/)[0]);
                lastRefreshSpan.textContent = `마지막 업데이트: ${minutes + 1}분 전`;
            }
        }, 60000);
    });
</script>
{% endblock %} <!-- end of extra_js block -->
{% endblock %} <!-- end of content block -->